{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="0">
    <title>Academic Scheduling System - Staff Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'hello/css/staff_dashboard.css' %}?v=2.0">
    <link rel="stylesheet" href="{% static 'hello/css/account_settings.css' %}">
</head>
<body>
<!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="page-title">DASHBOARD</div>
    <div class="account-section" onclick="toggleDropdown(event)">
            <div class="account-avatar" {% if faculty.profile_picture %}style="background-image: url('{{ faculty.profile_picture.url }}'); background-size: cover; background-position: center;"{% endif %}></div>
            <span class="account-name">{{ user.first_name|default:user.username|title }}</span>
            <svg class="dropdown-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M7 10l5 5 5-5z"/>
            </svg>
            <div class="dropdown-menu account-dropdown-menu">
                <a href="#" onclick="openAccountSettings(event)">Account Settings</a>
                <a href="{% url 'admin_logout' %}">Logout</a>
            </div>
        </div>
    </nav>
    {% include 'hello/account_settings.html' %}
    
        <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <a href="{% url 'staff_dashboard' %}" class="nav-item{% if request.resolver_match.url_name == 'staff_dashboard' %} active{% endif %}">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M4 13h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zm0 8h6c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1zm10 0h6c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zM13 4v4c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1z"/>
            </svg>
            <span>Dashboard</span>
        </a>
        <a href="{% url 'staff_schedule' %}" class="nav-item{% if request.resolver_match.url_name == 'staff_schedule' %} active{% endif %}">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
            </svg>
            <span>Schedule</span>
        </a>
    </aside>

        <!-- Main Content Area -->
            <main class="main-content">
        <!-- Welcome Card -->
            <div class="welcome-card">
                <h1>WELCOME BACK, {{ user.first_name|default:user.username|upper }}!</h1>
                <div class="semester-info">
                    <div>First Semester</div>
                    <div>2025-2026</div>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div class="dashboard-content">
                <div class="welcome-section">
                    <h3>Academic Scheduling System Integrating Scheduling & Timetables</h3>
                    <p>A web-based solution designed to simplify and automate academic scheduling, ensuring organized, conflict-free, and efficient timetable management for the faculty.</p>
                </div>

                <!-- Feature Cards Grid -->
                <div class="features-grid">
                    <!-- Card 1 -->
                    <div class="card">
                        <div class="blob"></div>
                        <div class="bg">
                            <div class="card-content">
                                <div class="icon-wrapper">
                                    <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 900" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Custom icon">
                                        <g transform="translate(0.000000,900.000000) scale(0.100000,-0.100000)" fill="currentColor" stroke="none">
                                            <path d="M2123 8988 c1 -6 -11 -16 -28 -21 -71 -22 -124 -54 -175 -106 -78
                                            -78 -100 -126 -128 -276 l-8 -40 -304 -6 c-304 -5 -347 -9 -505 -50 -284 -73
                                            -537 -243 -714 -479 -31 -42 -62 -84 -68 -95 -31 -49 -104 -206 -123 -265 -11
                                            -36 -25 -80 -31 -98 -6 -19 -16 -59 -22 -90 -16 -85 -23 -6226 -7 -6342 16
                                            -116 63 -265 121 -385 57 -117 57 -117 130 -215 117 -156 298 -306 471 -389
                                            109 -52 265 -104 358 -118 72 -10 6728 -10 6800 0 98 15 251 67 365 123 107
                                            53 109 54 205 125 97 73 231 213 297 312 60 88 131 234 158 322 10 33 24 77
                                            31 98 8 20 14 54 15 75 1 50 13 88 27 84 9 -1 12 751 12 3107 0 2652 -2 3110
                                            -14 3114 -8 3 -17 28 -21 59 -16 129 -102 364 -178 483 -179 282 -465 492
                                            -782 574 -158 41 -201 45 -505 50 l-304 6 -8 40 c-28 150 -50 198 -128 276
                                            -51 52 -104 84 -175 106 -16 5 -29 15 -28 21 2 9 -30 12 -117 12 -87 0 -119
                                            -3 -117 -12 1 -6 -11 -16 -28 -21 -71 -22 -124 -54 -175 -106 -78 -78 -100
                                            -126 -128 -276 l-8 -40 -1794 0 -1795 0 -11 60 c-18 98 -32 139 -65 188 -54
                                            82 -136 143 -234 174 -16 5 -29 15 -28 21 2 9 -30 12 -117 12 -87 0 -119 -3
                                            -117 -12z m-331 -1393 c28 -150 50 -198 128 -276 86 -86 183 -124 320 -124
                                            137 0 234 38 320 124 78 78 100 126 128 276 l8 40 1794 0 1794 0 8 -40 c28
                                            -150 50 -198 128 -276 86 -86 183 -124 320 -124 137 0 234 38 320 124 78 78
                                            100 126 128 276 l8 40 267 3 c282 2 311 -1 412 -52 87 -44 161 -137 195 -244
                                            19 -65 20 -86 18 -557 l-3 -490 -3595 0 -3595 0 -3 490 c-2 472 -1 492 19 557
                                            42 136 127 225 262 274 59 21 74 22 337 21 l274 -2 8 -40z m6298 -4274 c0
                                            -2010 -1 -2070 -19 -2127 -29 -88 -50 -124 -105 -180 -56 -55 -92 -76 -180
                                            -105 -57 -19 -135 -19 -3296 -19 -3161 0 -3239 0 -3296 19 -88 29 -124 50
                                            -180 105 -55 56 -76 92 -105 180 -18 57 -19 117 -19 2127 l0 2069 3600 0 3600
                                            0 0 -2069z"/>
                                            <path d="M2110 4471 c-91 -26 -127 -47 -190 -110 -91 -91 -125 -180 -125 -321
                                            0 -142 35 -230 125 -320 63 -64 109 -90 200 -114 61 -16 224 -17 2395 -14
                                            1960 3 2336 5 2365 17 93 37 129 59 180 110 91 91 125 180 125 321 0 89 -15
                                            158 -49 225 -28 54 -121 147 -176 173 -113 55 28 52 -2475 51 -2201 0 -2313
                                            -1 -2375 -18z"/>
                                            <path d="M2165 2684 c-125 -27 -190 -61 -255 -131 -83 -91 -115 -178 -115
                                            -313 0 -142 35 -230 125 -320 59 -60 107 -88 185 -111 73 -20 3346 -21 3415 0
                                            84 25 135 54 190 110 91 91 125 180 125 321 0 141 -34 230 -125 321 -51 51
                                            -87 73 -180 110 -29 12 -304 14 -1690 15 -910 1 -1664 0 -1675 -2z"/>
                                        </g>
                                    </svg>
                                </div>
                                <div class="text-content">
                                    <h4>Automated Schedule Generation</h4>
                                    <p>Automatically generates class schedules based on room availability, faculty load, and subject requirements, ensuring conflict-free assignments.</p>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Card 2 -->
                    <div class="card">
                        <div class="blob"></div>
                        <div class="bg">
                            <div class="card-content">
                                <div class="icon-wrapper">
                                    <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Conflict Detection">
                                        <g transform="translate(0.000000,300.000000) scale(0.100000,-0.100000)" fill="currentColor" stroke="none">
                                            <path d="M1045 2894 c-158 -28 -324 -96 -460 -187 -33 -22 -99 -79 -148 -126 -448 -436 -464 -1155 -35 -1607 339 -357 842 -459 1301 -263 39 16 74 28 78 27 4 -2 53 -68 108 -146 226 -321 337 -438 454 -479 70 -24 214 -24 284 0 209 73 329 311 265 524 -12 38 -39 94 -62 126 -47 65 -218 206 -436 358 l-142 100 34 74 c142 307 131 692 -29 999 -226 436 -732 686 -1212 600z m389 -180 c318 -60 604 -303 715 -606 47 -128 55 -178 56 -343 0 -192 -18 -273 -95 -431 -101 -208 -247 -351 -462 -454 -141 -68 -218 -83 -408 -84 -143 -1 -176 2 -249 22 -302 82 -549 305 -660 592 -70 181 -84 401 -37 585 132 511 617 818 1140 719z m880 -1751 c355 -250 418 -318 418 -448 1 -100 -47 -177 -137 -222 -104 -53 -224 -26 -311 71 -79 87 -335 438 -346 473 -2 5 24 32 57 60 34 28 83 78 110 111 57 71 37 75 209 -45z"/>
                                            <path d="M1108 2520 c-118 -20 -269 -90 -361 -168 -117 -100 -214 -252 -254 -402 -24 -89 -24 -290 0 -380 97 -367 452 -613 822 -572 330 36 593 267 672 589 22 93 22 266 -2 358 -74 291 -310 515 -601 571 -81 15 -199 17 -276 4z m287 -187 c154 -38 305 -162 375 -309 111 -230 66 -501 -114 -679 -128 -128 -269 -181 -451 -172 -117 6 -196 30 -286 88 -318 206 -366 652 -99 919 63 63 160 123 240 149 100 32 219 33 335 4z"/>
                                            <path d="M1198 2144 c-15 -8 -32 -23 -38 -34 -6 -11 -10 -99 -10 -213 0 -180 2 -196 20 -220 42 -53 127 -39 149 24 6 19 11 103 11 201 0 186 -9 225 -56 247 -32 14 -43 14 -76 -5z"/>
                                            <path d="M1179 1511 c-31 -31 -36 -59 -17 -94 27 -52 88 -63 133 -24 58 49 20 147 -56 147 -20 0 -40 -10 -60 -29z"/>
                                            <path d="M2453 590 c-64 -26 -67 -117 -6 -153 28 -16 38 -17 69 -7 70 23 79 122 13 155 -32 17 -44 18 -76 5z"/>
                                        </g>
                                    </svg>
                                </div>
                                <div class="text-content">
                                    <h4>Conflict Detection and Validation</h4>
                                    <p>Ensures all schedules are free from overlaps. The system alerts the admin of any time or room conflicts during manual adjustments.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card 3 -->
                    <div class="card">
                        <div class="blob"></div>
                        <div class="bg">
                            <div class="card-content">
                                <div class="icon-wrapper">
                                    <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" role="img" aria-label="Faculty and Room Management">
                                        <path fill="currentColor" d="M16.5 12c1.38 0 2.49-1.12 2.49-2.5S17.88 7 16.5 7C15.12 7 14 8.12 14 9.5s1.12 2.5 2.5 2.5zM9 11c1.66 0 2.99-1.34 2.99-3S10.66 5 9 5C7.34 5 6 6.34 6 8s1.34 3 3 3zm7.5 3c-1.83 0-5.5.92-5.5 2.75V19h11v-2.25c0-1.83-3.67-2.75-5.5-2.75zM9 13c-2.33 0-7 1.17-7 3.5V19h7v-2.25c0-.85.33-2.34 2.37-3.47C10.5 13.1 9.66 13 9 13z"/>
                                    </svg>
                                </div>
                                <div class="text-content">
                                    <h4>Faculty & Room Management</h4>
                                    <p>Centralized management of faculty profiles, teaching loads, and classroom details for efficient scheduling and resource allocation.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card 4 -->
                    <div class="card">
                        <div class="blob"></div>
                        <div class="bg">
                            <div class="card-content">
                                <div class="icon-wrapper">
                                    <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Real-time Schedule Updates">
                                        <metadata>Created by potrace 1.10, written by Peter Selinger 2001-2011</metadata>
                                        <g transform="translate(0.000000,300.000000) scale(0.100000,-0.100000)" fill="currentColor" stroke="none">
                                            <path d="M1180 2994 c-278 -35 -530 -145 -729 -321 -223 -196 -365 -442 -428
                                            -743 -24 -117 -24 -372 1 -490 85 -409 336 -740 702 -924 186 -94 371 -136
                                            593 -136 130 0 137 -1 150 -23 85 -136 270 -267 456 -323 77 -23 109 -27 225
                                            -28 163 -1 231 15 375 84 177 85 299 208 385 385 78 160 103 310 81 476 -31
                                            232 -175 472 -348 580 -22 13 -23 20 -23 150 0 79 -7 175 -16 230 -70 410
                                            -334 763 -713 953 -87 45 -219 89 -326 111 -78 16 -315 28 -385 19z m183 -428
                                            c18 -7 45 -28 60 -45 l27 -33 0 -419 c0 -344 -3 -425 -14 -447 -8 -15 -108
                                            -120 -223 -234 -175 -173 -214 -207 -245 -213 -50 -9 -101 9 -138 51 -24 28
                                            -30 44 -30 80 0 25 5 55 11 67 6 12 89 101 185 197 l173 175 3 372 c3 358 4
                                            373 24 400 23 32 78 63 112 63 12 0 37 -6 55 -14z m960 -1186 c230 -72 397
                                            -296 397 -535 0 -75 -26 -182 -62 -255 -43 -88 -160 -205 -248 -248 -214 -105
                                            -460 -70 -633 88 -266 245 -235 679 63 879 145 97 318 122 483 71z"/>
                                            <path d="M2375 1109 c-11 -6 -86 -77 -167 -157 l-146 -145 -59 57 c-68 66
                                            -113 84 -165 67 -45 -15 -88 -61 -97 -103 -14 -64 4 -96 122 -216 62 -62 124
                                            -120 139 -128 32 -17 76 -18 114 -3 16 5 119 101 231 211 225 224 246 255 224
                                            327 -6 22 -27 53 -46 70 -29 25 -44 31 -83 31 -26 0 -56 -6 -67 -11z"/>
                                        </g>
                                    </svg>
                                </div>
                                <div class="text-content">
                                    <h4>Real-time Schedule Updates</h4>
                                    <p>Instantly reflects any schedule or room changes made by the admin, allowing faculty to view updated timetables in real time.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CTA Section -->
                <div class="cta-section">
                    <div class="cta-card">
                        <h4>Ready to view your schedule?</h4>
                        <a href="{% url 'staff_schedule' %}" class="cta-button">
                            VIEW MY SCHEDULE
                        </a>
                    </div>
                </div>
            </main>
            </div>
        </div>
    </div>

    <script>
        // Function to open account settings modal
        function openAccountSettings(event) {
            event.preventDefault();
            const modal = document.getElementById('accountSettingsModal');
            if (modal) {
                modal.style.display = 'flex';
            }
        }
        
        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - initializing...');
            
            // Get all elements we need
            const modal = document.getElementById('accountSettingsModal');
            const saveBtn = document.getElementById('saveBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const deleteBtn = document.getElementById('deleteBtn');
            // File upload button handler
            const uploadBtn = document.getElementById('uploadBtn');
            if (uploadBtn) {
                uploadBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    document.getElementById('profilePicInput').click();
                    console.log('Upload button clicked');
                }, true);
            }
            
            const fileInput = document.getElementById('profilePicInput');
            
            console.log('saveBtn:', saveBtn);
            console.log('cancelBtn:', cancelBtn);
            
            // Delete button handler
            if (deleteBtn) {
                deleteBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (confirm('Are you sure you want to delete your profile picture?')) {
                        // Clear the preview
                        const previewPic = document.getElementById('previewProfilePic');
                        if (previewPic) {
                            previewPic.style.backgroundImage = '';
                        }
                        // Clear the file input
                        if (fileInput) {
                            fileInput.value = '';
                        }
                    }
                }, true);
            }
            
            // Save button click handler
            if (saveBtn) {
                saveBtn.addEventListener('click', function(e) {
                    console.log('Save button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const form = document.querySelector('.account-form');
                    const textInputs = form.querySelectorAll('input[type="text"]');
                    const genderSelect = form.querySelector('select');
                    
                    // Read password fields by their ID to avoid selector timing issues
                    const currentPasswordEl = document.getElementById('currentPassword');
                    const newPasswordEl = document.getElementById('newPassword');
                    
                    const firstName = textInputs[0] ? textInputs[0].value.trim() : '';
                    const lastName = textInputs[1] ? textInputs[1].value.trim() : '';
                    const email = form.querySelector('input[type="email"]') ? form.querySelector('input[type="email"]').value.trim() : '';
                    const gender = genderSelect ? genderSelect.value : '';
                    const currentPassword = currentPasswordEl ? currentPasswordEl.value : '';
                    const newPassword = newPasswordEl ? newPasswordEl.value : '';
                    const profilePicInput = document.getElementById('profilePicInput');

                    console.log('DEBUG: Found password elements:', !!currentPasswordEl, !!newPasswordEl);
                    console.log('DEBUG: currentPasswordEl:', currentPasswordEl);
                    console.log('DEBUG: newPasswordEl:', newPasswordEl);
                    console.log('Form data:', {firstName, lastName, email, gender, currentPassword: currentPassword ? '***' : '', newPassword: newPassword ? '***' : ''});
                    
                    if (!firstName || !lastName || !email) {
                        alert('Please fill in all required fields');
                        return;
                    }
                    
                    // Check if trying to change password but current password is missing
                    if (newPassword && !currentPassword) {
                        alert('Please enter your current password to set a new password');
                        return;
                    }
                    
                    // Validate new password strength (only if a new password is provided)
                    if (newPassword) {
                        const passwordErrors = [];
                        
                        console.log('Validating password:', newPassword);
                        console.log('Length:', newPassword.length);
                        console.log('Has uppercase:', /[A-Z]/.test(newPassword));
                        console.log('Has special char:', /[!@#$%^&*]/.test(newPassword));

                        if (newPassword.length < 8) {
                            passwordErrors.push('at least 8 characters long');
                        }

                        if (!/[A-Z]/.test(newPassword)) {
                            passwordErrors.push('at least one uppercase letter (A-Z)');
                        }

                        if (!/[!@#$%^&*]/.test(newPassword)) {
                            passwordErrors.push('at least one special character (!@#$%^&*)');
                        }
                        
                        if (passwordErrors.length > 0) {
                            console.log('Password validation failed:', passwordErrors);
                            alert('New password must have: ' + passwordErrors.join(', '));
                            return;
                        }
                        console.log('Password validation passed');
                    }
                    
                    // Build FormData for sending data and file
                    const formData = new FormData();
                    formData.append('firstName', firstName);
                    formData.append('lastName', lastName);
                    formData.append('email', email);
                    formData.append('gender', gender);
                    if (currentPassword) formData.append('currentPassword', currentPassword);
                    if (newPassword) formData.append('newPassword', newPassword);
                    if (profilePicInput.files.length > 0) {
                        formData.append('profilePicture', profilePicInput.files[0]);
                    }
                    
                    // Get CSRF token from the page
                    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
                    const token = csrfToken ? csrfToken.value : '';
                    
                    // Send data to backend
                    fetch('/staff/account/save/', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': token
                        },
                        body: formData
                    })
                    .then(response => {
                        console.log('Response status:', response.status);
                        return response.json().then(data => ({
                            status: response.status,
                            data: data
                        }));
                    })
                    .then(result => {
                        const { status, data } = result;
                        console.log('Response from server:', data);
                        
                        if (status >= 400) {
                            // Server returned an error (4xx or 5xx)
                            const errorMessage = data.errors ? data.errors.join('\n') : data.error || 'An error occurred';
                            alert('Error saving account settings:\n' + errorMessage);
                            return;
                        }
                        
                        if (data.success) {
                            // Update account avatar if profile picture was uploaded
                            const profilePic = document.querySelector('.profile-pic');
                            const profilePicBackgroundImage = profilePic.style.backgroundImage;
                            
                            if (profilePicBackgroundImage && profilePicBackgroundImage !== 'none') {
                                // Update the account avatar in the top nav
                                const accountAvatar = document.querySelector('.account-avatar');
                                accountAvatar.style.backgroundImage = profilePicBackgroundImage;
                                accountAvatar.style.backgroundSize = 'cover';
                                accountAvatar.style.backgroundPosition = 'center';
                                console.log('Account avatar updated');
                            }
                            
                            alert('Account settings saved successfully!');
                            modal.style.display = 'none';
                            // Reload page to ensure profile picture persists on re-login
                            window.location.reload();
                        } else {
                            const errorMessage = data.errors ? data.errors.join('\n') : data.error || 'An error occurred';
                            alert('Error saving account settings:\n' + errorMessage);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Error communicating with server: ' + error.message);
                    });
                }, true);
            }
            
            // Cancel button click handler
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function(e) {
                    console.log('Cancel button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    modal.style.display = 'none';
                }, true);
            }
            
            // Password visibility toggle
            const toggleButtons = document.querySelectorAll('.toggle-password');
            toggleButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const wrapper = this.parentElement;
                    const input = wrapper.querySelector('input');
                    
                    if (input.type === 'password') {
                        input.type = 'text';
                        this.classList.add('visible');
                    } else {
                        input.type = 'password';
                        this.classList.remove('visible');
                    }
                }, true);
            });
            
            // File upload handler
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    console.log('File selected:', e.target.files[0]);
                    if (this.files && this.files[0]) {
                        const file = this.files[0];
                        
                        // Validate file type
                        if (!file.type.match('image/(png|jpeg)')) {
                            alert('Please select a PNG or JPEG image');
                            this.value = ''; // Clear the input
                            return;
                        }
                        
                        // Validate file size
                        if (file.size > 15 * 1024 * 1024) {
                            alert('File size must be under 15MB');
                            this.value = ''; // Clear the input
                            return;
                        }
                        
                        // Read file and display preview
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const imageUrl = e.target.result;
                            
                            // Update profile picture in modal
                            const profilePic = document.querySelector('.profile-pic');
                            profilePic.style.backgroundImage = 'url(' + imageUrl + ')';
                            profilePic.style.backgroundSize = 'cover';
                            profilePic.style.backgroundPosition = 'center';
                            
                            console.log('Preview image set:', imageUrl.substring(0, 50) + '...');
                        };
                        reader.onerror = function(error) {
                            console.error('Error reading file:', error);
                            alert('Error reading file: ' + error.message);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // Navigation items
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    navItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        });

        // Dropdown toggle for account-section
        function toggleDropdown(event) {
            if (event) event.preventDefault();
            if (event) event.stopPropagation();
            const dropdown = event.currentTarget?.querySelector('.dropdown-menu') || document.querySelector('.account-dropdown-menu');
            if (dropdown) dropdown.classList.toggle('show');
        }

        // Hide dropdown when clicking outside
        document.addEventListener('click', function(event) {
            // Close account dropdown
            if (!event.target.closest('.account-section') && !event.target.closest('.admin-section')) {
                const accountDropdown = document.querySelector('.account-dropdown-menu');
                if (accountDropdown) accountDropdown.classList.remove('show');
            }
        });
    </script>
</body>
</html>
