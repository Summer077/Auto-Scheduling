{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Dashboard - ASSIST</title>
    <link rel="stylesheet" href="{% static 'hello/css/faculty.css' %}">
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="page-title">My Schedule</div>
        <div class="admin-section" onclick="toggleDropdown()">
            <div class="admin-avatar"></div>
            <span class="admin-name">{{ faculty.full_name }}</span>
            <svg class="dropdown-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M7 10l5 5 5-5z"/>
            </svg>
            <div class="dropdown-menu" id="dropdownMenu">
                <a href="{% url 'admin_logout' %}">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content" style="margin-left: 0;">
        <div class="content-wrapper">
            <!-- Schedule View -->
            <div class="right-panel">
                <div class="schedule-view">
                    <div class="schedule-header">
                        <div class="schedule-title-section">
                            <h2>{{ faculty.full_name }}</h2>
                            <p>{{ faculty.email }} â€¢ {{ faculty.total_units }} units assigned</p>
                        </div>
                        <div class="schedule-actions">
                            <button class="btn-print" onclick="window.print()">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">
                                    <path fill="currentColor" d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                                </svg>
                                PRINT
                            </button>
                        </div>
                    </div>

                    <div class="schedule-content">
                        <div class="schedule-grid-wrapper">
                            <div class="schedule-grid">
                                <!-- Header Row -->
                                <div class="schedule-header-row">
                                    <div class="schedule-header-cell"></div>
                                    <div class="schedule-header-cell">MONDAY</div>
                                    <div class="schedule-header-cell">TUESDAY</div>
                                    <div class="schedule-header-cell">WEDNESDAY</div>
                                    <div class="schedule-header-cell">THURSDAY</div>
                                    <div class="schedule-header-cell">FRIDAY</div>
                                    <div class="schedule-header-cell">SATURDAY</div>
                                </div>

                                <!-- Time Column -->
                                <div class="schedule-time-column" id="timeColumn"></div>

                                <!-- Day Columns -->
                                <div class="schedule-day-column" data-day="0"></div>
                                <div class="schedule-day-column" data-day="1"></div>
                                <div class="schedule-day-column" data-day="2"></div>
                                <div class="schedule-day-column" data-day="3"></div>
                                <div class="schedule-day-column" data-day="4"></div>
                                <div class="schedule-day-column" data-day="5"></div>
                            </div>
                        </div>

                        <div class="specializations-sidebar">
                            <h3>SPECIALIZATIONS</h3>
                            <p class="sidebar-info">{{ faculty.total_units }} units assigned</p>
                            <div class="specializations-list">
                                {% for spec in specializations %}
                                <div class="specialization-item" style="border-left-color: {{ spec.color }};">
                                    <div class="specialization-details">
                                        <div class="specialization-code">{{ spec.course_code }}</div>
                                        <div class="specialization-title">{{ spec.descriptive_title }}</div>
                                    </div>
                                </div>
                                {% empty %}
                                <p style="color: #6C757D; font-size: 0.875rem;">No specializations assigned</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        function toggleDropdown() {
            document.getElementById('dropdownMenu').classList.toggle('show');
        }

        window.onclick = function(event) {
            if (!event.target.matches('.admin-section') && !event.target.closest('.admin-section')) {
                document.getElementById('dropdownMenu').classList.remove('show');
            }
        }

        // Generate time slots and render schedule
        function initializeSchedule() {
            const timeSlots = generateTimeSlots();
            const timeColumn = document.getElementById('timeColumn');
            
            timeSlots.forEach(time => {
                const label = document.createElement('div');
                label.className = 'time-label';
                label.textContent = time;
                label.style.top = `${calculateTopPosition(time)}px`;
                timeColumn.appendChild(label);
            });
            
            renderSchedule();
        }

        function generateTimeSlots() {
            const slots = ['07:30'];
            for (let hour = 8; hour <= 21; hour++) {
                slots.push(`${hour.toString().padStart(2, '0')}:00`);
                if (hour < 21) {
                    slots.push(`${hour.toString().padStart(2, '0')}:30`);
                }
            }
            slots.push('21:30');
            return slots;
        }

        function calculateTopPosition(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            const totalMinutes = (hours * 60 + minutes) - (7 * 60);
            return (totalMinutes / 30) * 60;
        }

        function hexToRGBA(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function calculateDuration(startTime, endTime) {
            const [startHour, startMin] = startTime.split(':').map(Number);
            const [endHour, endMin] = endTime.split(':').map(Number);
            return (endHour * 60 + endMin) - (startHour * 60 + startMin);
        }

        function renderSchedule() {
            const schedules = {{ schedules|safe }};
            
            schedules.forEach(schedule => {
                const dayColumn = document.querySelector(`.schedule-day-column[data-day="${schedule.day}"]`);
                if (!dayColumn) return;
                
                const block = document.createElement('div');
                block.className = 'schedule-block';
                
                const topPos = calculateTopPosition(schedule.start_time);
                const duration = schedule.duration || calculateDuration(schedule.start_time, schedule.end_time);
                const height = (duration / 30) * 60;
                
                const hexColor = schedule.course_color;
                block.style.backgroundColor = hexToRGBA(hexColor, 0.25);
                block.style.borderLeftColor = hexColor;
                block.style.top = `${topPos}px`;
                block.style.height = `${height}px`;
                
                block.innerHTML = `
                    <div class="schedule-course-code">${schedule.course_code}</div>
                    <div class="schedule-details">${schedule.start_time} - ${schedule.end_time}</div>
                    <div class="schedule-details">Room: ${schedule.room}</div>
                    <div class="schedule-details">Section: ${schedule.section_name}</div>
                `;
                
                dayColumn.appendChild(block);
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeSchedule);
    </script>
</body>
</html>