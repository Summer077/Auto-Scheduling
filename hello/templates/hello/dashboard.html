{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ASSIST</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'hello/css/dashboard.css' %}">
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="page-title">DASHBOARD</div>
        <div class="admin-section" onclick="toggleDropdown()">
            <span class="admin-name">ADMIN</span>
            <svg class="dropdown-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M7 10l5 5 5-5z"/>
            </svg>
            <div class="dropdown-menu" id="dropdownMenu">
                <a href="{% url 'admin_logout' %}">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <a href="{% url 'admin_dashboard' %}" class="nav-item active">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M4 13h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zm0 8h6c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1zm10 0h6c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zM13 4v4c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1z"/>
            </svg>
            <span>Dashboard</span>
        </a>
        
        <a href="{% url 'course_view' %}" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/>
            </svg>
            <span>Course</span>
        </a>
        
        <a href="{% url 'faculty_view' %}" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M16.5 12c1.38 0 2.49-1.12 2.49-2.5S17.88 7 16.5 7C15.12 7 14 8.12 14 9.5s1.12 2.5 2.5 2.5zM9 11c1.66 0 2.99-1.34 2.99-3S10.66 5 9 5C7.34 5 6 6.34 6 8s1.34 3 3 3zm7.5 3c-1.83 0-5.5.92-5.5 2.75V19h11v-2.25c0-1.83-3.67-2.75-5.5-2.75zM9 13c-2.33 0-7 1.17-7 3.5V19h7v-2.25c0-.85.33-2.34 2.37-3.47C10.5 13.1 9.66 13 9 13z"/>
            </svg>
            <span>Faculty</span>
        </a>
        
        <a href="{% url 'section_view' %}" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
            </svg>
            <span>Section</span>
        </a>

        <a href="{% url 'room_view' %}" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/>
            </svg>
            <span>Room</span>
        </a>
        
        <a href="{% url 'schedule_view' %}" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
            </svg>
            <span>Schedule</span>
        </a>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Welcome Card -->
        <div class="welcome-card">
            <h1>WELCOME BACK, ADMIN!</h1>
            <div class="semester-info">
                <div>First Semester</div>
                <div>2025-2026</div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="content-grid">
            <!-- Summary Section -->
            <div class="summary-section">
                <h2>Summary</h2>
                
                <div class="summary-card faculty-card">
                    <div class="summary-number">{{ faculty_count }}</div>
                    <div class="summary-label">FACULTY</div>
                    <svg class="summary-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                    </svg>
                    <div class="summary-decoration top-left"></div>
                    <div class="summary-decoration bottom-right"></div>
                    
                    <div class="card-hover-content">
                        {% if faculty_list %}
                            <div class="card-data-table">
                                <div class="card-data-header">
                                    <span>Name</span>
                                    <span>Total Units</span>
                                </div>
                                {% for faculty in faculty_list %}
                                <div class="card-data-row">
                                    <div class="card-data-name">{{ faculty.last_name }}, {{ faculty.first_name }}</div>
                                    <div class="card-data-value">{{ faculty.total_units|default:"0" }}</div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="card-empty-message">No faculty members added yet</div>
                        {% endif %}
                    </div>
                </div>

                <div class="summary-card section-card">
                    <div class="summary-number">{{ section_count }}</div>
                    <div class="summary-label">SECTIONS</div>
                    <svg class="summary-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7zm-4 6h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                    </svg>
                    <div class="summary-decoration top-left"></div>
                    <div class="summary-decoration bottom-right"></div>
                    
                    <div class="card-hover-content">
                        {% if section_list %}
                            <div class="card-data-table">
                                <div class="card-data-header">
                                    <span>Section</span>
                                    <span>Status</span>
                                </div>
                                {% for section in section_list %}
                                <div class="card-data-row">
                                    <div class="card-data-name">{{ section.name }}</div>
                                    <div class="card-data-value">
                                        {% if section.has_schedule %}
                                            <span class="card-status-badge status-complete">Complete Schedule</span>
                                        {% else %}
                                            <span class="card-status-badge status-no-schedule">No Schedule Yet</span>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="card-empty-message">No sections added yet</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Recent Activity Section -->
            <div class="activity-section">
                <h2>Recent Activity</h2>
                
                <div id="activityContainer">
                    {% if recent_activities %}
                        {% for day, activities in recent_activities.items %}
                        <div class="activity-day">
                            <div class="activity-day-label">{{ day }}</div>
                            {% for activity in activities %}
                            <div class="activity-item">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                    <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                                </svg>
                                <span>{{ activity.message }}</span>
                                <span class="activity-time">{{ activity.timestamp|date:"m/d/Y g:i A" }}</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="activity-empty">No recent activity</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h2>Quick Actions</h2>
            <div class="quick-actions-grid">
                <div class="quick-action-card blue" onclick="openCreateScheduleModal()">
                    <h3 class="quick-action-title">Create Schedule</h3>
                    <div class="quick-action-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                        </svg>
                    </div>
                </div>
                
                <div class="quick-action-card green" onclick="openAddCourseModal()">
                    <h3 class="quick-action-title">Add Course</h3>
                    <div class="quick-action-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/>
                        </svg>
                    </div>
                </div>
                
                <div class="quick-action-card orange" onclick="openAddFacultyModal()">
                    <h3 class="quick-action-title">Add Faculty</h3>
                    <div class="quick-action-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                        </svg>
                    </div>
                </div>
                
                <div class="quick-action-card yellow" onclick="openAddSectionModal()">
                    <h3 class="quick-action-title">Add Section</h3>
                    <div class="quick-action-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                        </svg>
                    </div>
                </div>
                
                <div class="quick-action-card red" onclick="openAddRoomModal()">
                    <h3 class="quick-action-title">Add Room</h3>
                    <div class="quick-action-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Course Modal -->
    <div id="addCourseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Course</h2>
                <span class="close" onclick="closeModal('addCourseModal')">&times;</span>
            </div>
            <form id="addCourseForm" onsubmit="submitQuickAddCourse(event)">
                {% csrf_token %}
                <div class="form-group">
                    <label>Curriculum</label>
                    <select name="curriculum" required>
                        {% for curriculum in curricula %}
                        <option value="{{ curriculum.id }}">{{ curriculum.name }} ({{ curriculum.year }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Course Code</label>
                    <input type="text" name="course_code" placeholder="e.g., CPE 001" required>
                </div>
                <div class="form-group">
                    <label>Descriptive Title</label>
                    <input type="text" name="descriptive_title" placeholder="e.g., Software Design" required>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                    <div class="form-group">
                        <label>Lab Hours</label>
                        <input type="number" name="laboratory_hours" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Lec Hours</label>
                        <input type="number" name="lecture_hours" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>Credit Units</label>
                        <input type="number" name="credit_units" min="0" value="0" required>
                    </div>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                    <div class="form-group">
                        <label>Year Level</label>
                        <select name="year_level" required>
                            <option value="1">1st Year</option>
                            <option value="2">2nd Year</option>
                            <option value="3">3rd Year</option>
                            <option value="4">4th Year</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Semester</label>
                        <select name="semester" required>
                            <option value="1">1st Semester</option>
                            <option value="2">2nd Semester</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px; padding-top: 20px; border-top: 1px solid #E0E0E0; margin-top: 10px;">
                    <button type="button" class="btn-secondary" onclick="closeModal('addCourseModal')" style="padding: 12px 24px; background: #FFFFFF; border: 1px solid #DEE2E6; border-radius: 10px; color: #495057; font-family: 'Lexend', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer;">Cancel</button>
                    <button type="submit" class="btn-primary" style="padding: 12px 24px; background: #F8F9FA; border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 10px; color: #212529; font-family: 'Lexend', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">Add Course</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Faculty Modal -->
    <div id="addFacultyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Faculty</h2>
                <span class="close" onclick="closeModal('addFacultyModal')">&times;</span>
            </div>
            <form id="addFacultyForm" onsubmit="submitQuickAddFaculty(event)">
                {% csrf_token %}
                <div class="form-group">
                    <label class="checkbox-group-label" style="display: block; margin-bottom: 12px; font-family: 'Lexend', sans-serif; font-size: 0.9rem; font-weight: 600; color: #212529;">Account Type</label>
                    <div class="checkbox-group" style="display: flex; gap: 20px; align-items: center;">
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-family: 'Lexend', sans-serif; font-size: 0.95rem; color: #495057; font-weight: 500;">
                            <input type="radio" name="role" value="admin" required style="width: 18px; height: 18px; cursor: pointer; accent-color: #212529;">
                            <span>Admin</span>
                        </label>
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-family: 'Lexend', sans-serif; font-size: 0.95rem; color: #495057; font-weight: 500;">
                            <input type="radio" name="role" value="staff" checked required style="width: 18px; height: 18px; cursor: pointer; accent-color: #212529;">
                            <span>Staff</span>
                        </label>
                    </div>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" name="first_name" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" name="last_name" required>
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select name="gender" required>
                            <option value="M">Male</option>
                            <option value="F">Female</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" required>
                    <small style="color: #6C757D; font-size: 0.8rem; margin-top: 4px; display: block;">Auto-generated password will be sent to this email</small>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                    <div class="form-group">
                        <label>Employment Status</label>
                        <select name="employment_status" required>
                            <option value="full_time">Full-Time</option>
                            <option value="part_time">Part-Time</option>
                            <option value="contractual">Contractual</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Highest Degree Earned</label>
                        <input type="text" name="highest_degree" placeholder="e.g., PhD, Master's">
                    </div>
                </div>
                <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px; padding-top: 20px; border-top: 1px solid #E0E0E0; margin-top: 10px;">
                    <button type="button" class="btn-secondary" onclick="closeModal('addFacultyModal')" style="padding: 12px 24px; background: #FFFFFF; border: 1px solid #DEE2E6; border-radius: 10px; color: #495057; font-family: 'Lexend', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer;">Cancel</button>
                    <button type="submit" class="btn-primary" style="padding: 12px 24px; background: #F8F9FA; border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 10px; color: #212529; font-family: 'Lexend', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">Add Faculty</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Section Modal -->
    <div id="addSectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Section</h2>
                <span class="close" onclick="closeModal('addSectionModal')">&times;</span>
            </div>
            <form id="addSectionForm" onsubmit="submitQuickAddSection(event)">
                {% csrf_token %}
                <div class="form-group">
                    <label>Section Name</label>
                    <input type="text" name="name" placeholder="e.g., CPE11S1" required>
                    <small style="color: #6C757D; font-size: 0.8rem; margin-top: 4px; display: block;">
                        <strong>Format:</strong> CPE[year][semester]S[number]<br>
                        <strong>Examples:</strong> CPE11S1 (1st year, 1st sem, Section 1)
                    </small>
                </div>
                <div class="form-group">
                    <label>Curriculum</label>
                    <select name="curriculum" required>
                        {% for curriculum in curricula %}
                        <option value="{{ curriculum.id }}">{{ curriculum.name }} ({{ curriculum.year }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                    <div class="form-group">
                        <label>Year Level</label>
                        <select name="year_level" required>
                            <option value="1">1st Year</option>
                            <option value="2">2nd Year</option>
                            <option value="3">3rd Year</option>
                            <option value="4">4th Year</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Semester</label>
                        <select name="semester" required>
                            <option value="1">1st Semester</option>
                            <option value="2">2nd Semester</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Max Students</label>
                    <input type="number" name="max_students" min="1" value="40" required>
                </div>
                <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px; padding-top: 20px; border-top: 1px solid #E0E0E0; margin-top: 10px;">
                    <button type="button" class="btn-secondary" onclick="closeModal('addSectionModal')" style="padding: 12px 24px; background: #FFFFFF; border: 1px solid #DEE2E6; border-radius: 10px; color: #495057; font-family: 'Lexend', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer;">Cancel</button>
                    <button type="submit" class="btn-primary" style="padding: 12px 24px; background: #F8F9FA; border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 10px; color: #212529; font-family: 'Lexend', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">Add Section</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Room Modal -->
    <div id="addRoomModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Room</h2>
                <span class="close" onclick="closeModal('addRoomModal')">&times;</span>
            </div>
            <form id="addRoomForm" onsubmit="submitQuickAddRoom(event)">
                {% csrf_token %}
                <div class="form-group">
                    <label>Room Name</label>
                    <input type="text" name="name" placeholder="e.g., Computer Laboratory 1" required>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                    <div class="form-group">
                        <label>Room Number</label>
                        <input type="text" name="room_number" placeholder="e.g., 201" required>
                    </div>
                    <div class="form-group">
                        <label>Capacity</label>
                        <input type="number" name="capacity" min="1" value="40" required>
                    </div>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                    <div class="form-group">
                        <label>Campus</label>
                        <select name="campus" required>
                            <option value="casal">Casal</option>
                            <option value="arlegui">Arlegui</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Room Type</label>
                        <select name="room_type" required>
                            <option value="lecture">Lecture</option>
                            <option value="laboratory">Laboratory</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px; padding-top: 20px; border-top: 1px solid #E0E0E0; margin-top: 10px;">
                    <button type="button" class="btn-secondary" onclick="closeModal('addRoomModal')" style="padding: 12px 24px; background: #FFFFFF; border: 1px solid #DEE2E6; border-radius: 10px; color: #495057; font-family: 'Lexend', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer;">Cancel</button>
                    <button type="submit" class="btn-primary" style="padding: 12px 24px; background: #F8F9FA; border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 10px; color: #212529; font-family: 'Lexend', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">Add Room</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Schedule Modal -->
    <div id="createScheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Schedule</h2>
                <span class="close" onclick="closeModal('createScheduleModal')">&times;</span>
            </div>
            <form id="createScheduleForm" onsubmit="submitCreateSchedule(event)">
                {% csrf_token %}
                <div class="form-group">
                    <label>Course Code</label>
                    <select name="course" id="course_select" required>
                        <option value="">Select a course...</option>
                        {% for course in all_courses %}
                        <option value="{{ course.id }}">{{ course.course_code }} - {{ course.descriptive_title }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Instructor</label>
                    <select name="faculty" required>
                        <option value="">Select an instructor...</option>
                        {% for faculty in faculty_list %}
                        <option value="{{ faculty.id }}">{{ faculty.last_name }}, {{ faculty.first_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Section</label>
                    <select name="section" required>
                        <option value="">Select a section...</option>
                        {% for section in section_list %}
                        <option value="{{ section.id }}">{{ section.name }} - {% if section.year_level == 1 %}1st{% elif section.year_level == 2 %}2nd{% elif section.year_level == 3 %}3rd{% else %}4th{% endif %} Year, {% if section.semester == 1 %}1st{% else %}2nd{% endif %} Semester</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Room</label>
                    <select name="room" required>
                        <option value="">Select a room...</option>
                        {% for room in room_list %}
                        <option value="{{ room.id }}">{{ room.get_room_type_display }}: {% if room.campus == 'arlegui' %}A{% else %}C{% endif %}-{{ room.room_number }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Day</label>
                    <select name="day" required>
                        <option value="">Select a day...</option>
                        <option value="0">Monday</option>
                        <option value="1">Tuesday</option>
                        <option value="2">Wednesday</option>
                        <option value="3">Thursday</option>
                        <option value="4">Friday</option>
                        <option value="5">Saturday</option>
                    </select>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                    <div class="form-group">
                        <label>Start Time</label>
                        <input type="time" name="start_time" required>
                    </div>
                    <div class="form-group">
                        <label>End Time</label>
                        <input type="time" name="end_time" required>
                    </div>
                </div>
                <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px; padding-top: 20px; border-top: 1px solid #E0E0E0; margin-top: 10px;">
                    <button type="button" class="btn-secondary" onclick="closeModal('createScheduleModal')" style="padding: 12px 24px; background: #FFFFFF; border: 1px solid #DEE2E6; border-radius: 10px; color: #495057; font-family: 'Lexend', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer;">Cancel</button>
                    <button type="submit" class="btn-primary" style="padding: 12px 24px; background: #F8F9FA; border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 10px; color: #212529; font-family: 'Lexend', sans-serif; font-size: 0.95rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">Create Schedule</button>
                </div>
            </form>
        </div>
    </div>

        <!-- Schedule Section -->
        <div class="schedule-section">
            <h2>Schedule</h2>
            
            <div class="schedule-wrapper">
                <!-- Left sidebar with course list -->
                <div class="schedule-left">
                    <div class="courses-label">Courses</div>
                    <div class="courses-list">
                        {% if scheduled_courses %}
                            {% for course in scheduled_courses %}
                            <div class="course-label">
                                <div class="course-color" style="background: {{ course.color }};"></div>
                                <span>{{ course.course_code }} - {{ course.descriptive_title }}</span>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="courses-empty">No courses scheduled</div>
                        {% endif %}
                    </div>
                </div>

                <!-- Grid-based schedule -->
                <div class="schedule-grid-container">
                    <div class="schedule-grid">
                        <!-- Header Row -->
                        <div class="schedule-header">
                            <div class="schedule-header-cell"></div>
                            <div class="schedule-header-cell">MONDAY</div>
                            <div class="schedule-header-cell">TUESDAY</div>
                            <div class="schedule-header-cell">WEDNESDAY</div>
                            <div class="schedule-header-cell">THURSDAY</div>
                            <div class="schedule-header-cell">FRIDAY</div>
                            <div class="schedule-header-cell">SATURDAY</div>
                        </div>

                        <!-- Time Column (labels on grid lines) -->
                        <div class="schedule-time-column">
                            {% for time in time_slots %}
                            <div class="time-label" style="top: {{ time|schedule_top }}px;">
                                {{ time }}
                            </div>
                            {% endfor %}
                        </div>

                        <!-- Day Columns (Monday to Saturday) -->
                        {% for day_num, day_name in days %}
                        <div class="schedule-day-column" data-day="{{ day_num }}">
                            <!-- Render all schedules for this day -->
                            {% for schedule in schedules %}
                                {% if schedule.day == day_num %}
                                <div class="schedule-block" 
                                    style="
                                        background: {{ schedule.course.color|rgba_25 }}; 
                                        height: {{ schedule.duration|schedule_height }}px; 
                                        top: {{ schedule.start_time|schedule_top }}px;
                                        border-left-color: {{ schedule.course.color }};
                                    ">
                                    <div class="course-code">{{ schedule.course.course_code }}</div>
                                    <div class="course-details">{{ schedule.start_time }} - {{ schedule.end_time }}</div>
                                    <div class="course-details">Room: {{ schedule.room.name|default:'TBA' }}</div>
                                    <div class="course-details">Section: {{ schedule.section.name|default:'No Section' }}</div>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Dropdown toggle
        function toggleDropdown() {
            document.getElementById('dropdownMenu').classList.toggle('show');
        }

        // Close dropdown when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.admin-section') && !event.target.closest('.admin-section')) {
                document.getElementById('dropdownMenu').classList.remove('show');
            }
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function openAddCourseModal() {
            openModal('addCourseModal');
        }

        function openAddFacultyModal() {
            openModal('addFacultyModal');
        }

        function openAddSectionModal() {
            openModal('addSectionModal');
        }

        function openAddRoomModal() {
            openModal('addRoomModal');
        }

        function openCreateScheduleModal() {
            openModal('createScheduleModal');
        }

        // Submit functions
        function submitQuickAddCourse(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            fetch('/admin/course/add/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Course added successfully!', 'success');
                    closeModal('addCourseModal');
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    showNotification('Error adding course', 'error');
                }
            });
        }

        function submitQuickAddFaculty(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            fetch('/admin/faculty/add/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.message || 'Faculty added successfully!', 'success');
                    closeModal('addFacultyModal');
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    showNotification('Error adding faculty', 'error');
                }
            });
        }

        function submitQuickAddSection(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            fetch('/admin/section/add/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Section added successfully!', 'success');
                    closeModal('addSectionModal');
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    const errorMsg = data.errors ? data.errors.join('\n') : 'Error adding section';
                    showNotification(errorMsg, 'error');
                }
            });
        }

        function submitQuickAddRoom(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            fetch('/admin/room/add/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Room added successfully!', 'success');
                    closeModal('addRoomModal');
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    showNotification('Error adding room', 'error');
                }
            });
        }

        function submitCreateSchedule(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            fetch('/admin/schedule/add/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Schedule created successfully!', 'success');
                    closeModal('createScheduleModal');
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    const errorMsg = data.errors ? data.errors.join('\n') : 'Error creating schedule';
                    showNotification(errorMsg, 'error');
                }
            });
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type} show`;
            
            if (message.includes('\n')) {
                notification.style.whiteSpace = 'pre-line';
                notification.style.textAlign = 'left';
                notification.style.maxWidth = '500px';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>